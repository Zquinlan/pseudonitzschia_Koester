mutate(feature = gsub("_", ";", feature),
feature = gsub("SPACE", " ", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
write_csv(otu_rf_mda, "Analyzed/Otu_rf_mda.csv")
# POST-STATS -- Mini RF Table OTUs -------------------------------------
important_quant_otu <- (otu_rf_mda%>%
mutate(feature = gsub("X", "", feature))%>%
filter(MeanDecreaseAccuracy >= mean(MeanDecreaseAccuracy) + sd(MeanDecreaseAccuracy)))$feature%>%
as.vector()
mini_quant_otu <- quant_stats%>%
filter(feature_number %in% important_quant_otu)%>%
spread(feature_number, asin)
write_csv(mini_quant_otu, "Analyzed/mini_quant_otu.csv")
# STATS Correlation analysis ----------------------------------------------
## Correlation analysis
## Doing this between OTU and multiplied matrix
correlation_matrix <- matrix_multiplied_org%>%
gather(compound, val, 2:ncol(.))%>%
mutate(compound = gsub("[[:space:]]", ".", compound))%>%
mutate(compound = gsub("-", ".", compound))%>%
filter(compound %in% important_org_compounds)%>%
spread(compound, val)%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")%>%
select(-c(Experiment, technical_replicates))%>%
group_by(Organism, biological_replicates, DOM_fil)%>%
summarize_if(is.numeric, mean)%>%
ungroup()
correlation_microbe <- otu_stats%>%
filter(sample_code_16S %like% "%Exp2%")%>%
rename('sample_name' = 'sample_code_16S')%>%
filter(Taxonomy %like any% sig_otu)%>%
select(-c(reads, ra))%>%
spread(Taxonomy, asin)
correlation_table <- correlation_matrix%>%
filter(DOM_fil != 'Unfil')%>%
mutate(Experiment = 'Exp2')%>%
unite(sample_name, c("Experiment", "Organism", "biological_replicates"), sep = "_")%>%
left_join(correlation_microbe%>%
mutate(sample_name = gsub('.{2}$', "", sample_name)), by = "sample_name")%>%
gather(microbe, microbe_asin, contains(";"))%>%
gather(category, category_asin, 3:32)
correlation_pvals <- correlation_table%>%
ungroup()%>%
group_by(DOM_fil, microbe, category)%>%
filter(sum(category_asin) > 0)%>%
nest()%>%
mutate(corr = map(data, ~ cor.test(.x$category_asin, .x$microbe_asin, method = "pearson")%>%
broom::tidy()))%>%
dplyr::select(-data)%>%
unnest(corr)%>%
ungroup()%>%
mutate(FDR = p.adjust(p.value, method = "BH"))
write_csv(correlation_pvals, "Analyzed/correlation_analysis.csv")
View(correlation_pvals)
# POST-STATS -- mini-matrix unfilfil -----------------------------------------------
important_unfil_compounds <- (rf_matrix_UnfilFil_mda%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_dom <- matrix_multiplied_dom%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
filter(feature %in% important_unfil_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_dom, "Analyzed/mini_matrix_important_dom.csv")
# POST STATS -- matrix for HC ---------------------------------------------
otu_hc <- otu_stats%>%
filter(Taxonomy %in% important_org_otu)%>%
group_by(Taxonomy)%>%
filter(sample_code_16S %like% "Exp2%")%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
select(-c(reads, ra, asin))%>%
ungroup()%>%
spread(Taxonomy, zscore)
compound_org_hc <- mini_matrix_org%>%
gather(category, asin, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism",
"biological_replicate", "DOM_fil",
"technical_replicate"), sep = "_")%>%
group_by(category)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
group_by(category, Organism, biological_replicate, DOM_fil)%>%
select(-technical_replicate)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)%>%
ungroup()%>%
filter(DOM_fil == "DOM")%>%
select(-c(asin, DOM_fil))%>%
unite(sample, c("Organism", "biological_replicate"), sep = "_")%>%
spread(category, zscore)
compound_dom_hc <- mini_matrix_dom%>%
gather(category, asin, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism",
"biological_replicate", "DOM_fil",
"technical_replicate"), sep = "_")%>%
group_by(category)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
group_by(category, Organism, biological_replicate, DOM_fil)%>%
select(-technical_replicate)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)%>%
ungroup()%>%
select(-c(asin))%>%
unite(sample, c("Organism", "biological_replicate", "DOM_fil"), sep = "_")%>%
spread(category, zscore)
feature_org_hc <- mini_quant_org%>%
gather(feature_number, asin, 6:ncol(.))%>%
group_by(feature_number)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
group_by(feature_number, Organism, biological_replicates, DOM_fil)%>%
select(-technical_replicates)%>%
summarize_if(is.numeric, mean)%>%
ungroup()%>%
filter(DOM_fil == "DOM")%>%
select(-c(asin, DOM_fil))%>%
left_join(lib_id%>%
select(feature_number, Compound_Name), by = "feature_number")%>%
unite(feature, c(feature_number, Compound_Name), sep = "_")%>%
unite(sample, c("Organism", "biological_replicates"), sep = "_")%>%
spread(feature, zscore)
feature_dom_hc <- mini_quant_dom%>%
gather(feature_number, asin, 6:ncol(.))%>%
group_by(feature_number)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
group_by(feature_number, Organism, biological_replicates, DOM_fil)%>%
select(-technical_replicates)%>%
summarize_if(is.numeric, mean)%>%
ungroup()%>%
select(-c(asin))%>%
unite(sample, c("Organism", "biological_replicates", "DOM_fil"), sep = "_")%>%
left_join(lib_id%>%
select(feature_number, Compound_Name), by = "feature_number")%>%
unite(feature, c(feature_number, Compound_Name), sep = "_")%>%
spread(feature, zscore)
write_csv(compound_org_hc, "Analyzed/compound_org_hc.csv")
write_csv(compound_dom_hc, "Analyzed/compound_dom_hc.csv")
write_csv(feature_org_hc, "Analyzed/feature_org_hc.csv")
write_csv(feature_dom_hc, "Analyzed/feature_dom_hc.csv")
# VISUALIZATION -- Cytoscape ----------------------------------------------
cyto_base <- quant_df%>%
gather(sample_code, xic, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_", remove = FALSE)%>%
unite(sample_code, c("Organism", "biological_replicates"), sep = "_", remove = FALSE)%>%
left_join(chl%>%
mutate(sample_code = gsub("Pn_", "Pn-", sample_code)), by = "sample_code")%>%
select(-sample_code)%>%
filter(!Organism %like% '%PPLBlank%',
!Organism %like% '%MediaBlank%')%>%
unite(sample_code, c("Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_", remove = FALSE)%>%
group_by(sample_code)%>%
mutate(ra = xic/sum(xic),
chl_norm = ra/chl,
asin = asin(sqrt(chl_norm)))
cyto_exp2_dom <- cyto_base%>%
group_by(DOM_fil, feature_number)%>%
select(-c('chl', 'xic', 'asin', 'ra'))%>%
filter(Experiment == "Exp2")%>%
summarize_if(is.numeric, mean, na.rm = TRUE)%>%
spread(DOM_fil, chl_norm)%>%
select(-4)
cyto_exp2_org <- cyto_base%>%
group_by(Organism, DOM_fil, feature_number)%>%
select(-c('chl', 'xic', 'asin', 'ra'))%>%
filter(Experiment == "Exp2")%>%
unite(sample, c(Organism, DOM_fil), sep = "_")%>%
spread(sample, chl_norm)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)
cyto_exp2_org2 <- cyto_base%>%
group_by(Organism, feature_number)%>%
select(-c('chl', 'xic', 'asin', 'ra'))%>%
filter(Experiment == "Exp2")%>%
unite(sample, c(Organism), sep = "_")%>%
spread(sample, chl_norm)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)
cyto_exp1_org2 <- cyto_base%>%
group_by(Organism, feature_number)%>%
select(-c('chl', 'xic', 'asin', 'ra'))%>%
filter(Experiment == "Exp1")%>%
unite(sample, c(Experiment, Organism), sep = "_")%>%
spread(sample, chl_norm)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)
cyto_piers <- cyto_base%>%
group_by(Organism, biological_replicates, feature_number)%>%
select(-c('chl', 'xic', 'asin', 'chl_norm'))%>%
filter(Experiment == "Piers")%>%
unite(sample, c(Organism, biological_replicates), sep = "_")%>%
spread(sample, ra)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)
cyto_CCE <- cyto_base%>%
group_by(Organism, biological_replicates, feature_number)%>%
select(-c('chl', 'xic', 'asin', 'chl_norm'))%>%
filter(Experiment == "CCE-P1706")%>%
unite(sample, c(Organism, biological_replicates), sep = "_")%>%
spread(sample, ra)%>%
summarize_if(is.numeric, mean, na.rm = TRUE)
cyto_piers_mean <- cyto_base%>%
group_by(feature_number)%>%
select(-c('chl', 'xic', 'asin', 'chl_norm'))%>%
filter(Experiment == "Piers")%>%
summarize_if(is.numeric, mean, na.rm = TRUE)%>%
rename(mean_piers = 2)
cyto_CCE_mean <- cyto_base%>%
group_by(feature_number)%>%
select(-c('chl', 'xic', 'asin', 'chl_norm'))%>%
filter(Experiment == "CCE-P1706")%>%
summarize_if(is.numeric, mean, na.rm = TRUE)%>%
rename(mean_CCE = 2)
cyto_xic_sum <- cyto_base%>%
group_by(feature_number)%>%
select(-c('chl', 'ra', 'asin', 'chl_norm'))%>%
filter(Experiment == "Exp2")%>%
summarize_if(is.numeric, sum, na.rm = TRUE)%>%
rename(sum_xic_exp2 = 2)
cyto_xic_sum_env <- cyto_base%>%
group_by(feature_number)%>%
select(-c('chl', 'ra', 'asin', 'chl_norm'))%>%
filter(Experiment != "Exp1")%>%
summarize_if(is.numeric, sum, na.rm = TRUE)%>%
rename(sum_xic_exp2env = 2)
cyto_full <- cyto_exp2_org%>%
full_join(cyto_exp2_org2, by = "feature_number")%>%
full_join(cyto_exp2_dom, by = "feature_number")%>%
full_join(cyto_exp1_org2, by = "feature_number")%>%
full_join(cyto_piers, by = "feature_number")%>%
full_join(cyto_piers_mean, by = "feature_number")%>%
full_join(cyto_CCE, by = "feature_number")%>%
full_join(cyto_CCE_mean, by = "feature_number")%>%
full_join(cyto_xic_sum, by = "feature_number")%>%
full_join(cyto_xic_sum_env, by = "feature_number")
write_csv(cyto_full, "./Analyzed/cyto_node_table.csv")
## otu
pcoa_otu <- otu_stats%>%
separate(sample_code_16S, c("Experiment", "Organism", "biological_replicates",
"technical_replicates"), sep = "_")%>%
filter(Experiment != 'CCE-P1706',
Experiment != 'Piers')%>%
unite(sample_name, c("Experiment", "Organism", "biological_replicates",
"technical_replicates"), sep = "_")%>%
select(-c(reads, ra))%>%
spread(Taxonomy, asin)%>%
column_to_rownames("sample_name")%>%
vegdist(na.rm = TRUE)%>%
pcoa()
pcoa_otu$values[1:10,]%>%
as.data.frame()%>%
rownames_to_column("Axis")%>%
mutate(axis = as.numeric(Axis))%>%
ggplot(aes(reorder(Axis, axis), Relative_eig, label = round(Relative_eig, digits = 3))) +
geom_bar(stat = "identity") +
geom_text(size = 3, color = "red", vjust = -0.5)
## Organism Matrix
pcoa_org <- matrix_multiplied_org%>%
gather(cat, val, 2:ncol(.))%>%
mutate(val = val+ min(val) +1)%>%
spread(cat, val)%>%
column_to_rownames("sample_code")%>%
vegdist(na.rm = TRUE)%>%
pcoa()
pcoa_org$values[1:10,]%>%
as.data.frame()%>%
rownames_to_column("Axis")%>%
mutate(axis = as.numeric(Axis))%>%
ggplot(aes(reorder(Axis, axis), Relative_eig, label = round(Relative_eig, digits = 3))) +
geom_bar(stat = "identity") +
geom_text(size = 3, color = "red", vjust = -0.5)
## Unfil vs Fil matrix
pcoa_dom <- matrix_multiplied_dom%>%
gather(cat, val, 2:ncol(.))%>%
mutate(val = val+ min(val) +1)%>%
spread(cat, val)%>%
column_to_rownames("sample_code")%>%
vegdist(na.rm = TRUE)%>%
pcoa()
pcoa_dom$values[1:10,]%>%
as.data.frame()%>%
rownames_to_column("Axis")%>%
mutate(axis = as.numeric(Axis))%>%
ggplot(aes(reorder(Axis, axis), Relative_eig, label = round(Relative_eig, digits = 3))) +
geom_bar(stat = "identity") +
geom_text(size = 3, color = "red", vjust = -0.5)
#Settings for Pcoas
pcoa_settings <- function(x) {
ggplot(x, aes(Axis.1, Axis.2, color = Organism, shape = DOM_fil)) +
geom_point(stat = "identity") +
scale_color_manual(values = c("#75d648", "#ae2da9", "#2d67c7", "#f27304", "#64d6f7")) +
scale_shape_manual(values=c(1, 16))+
theme(panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
axis.title.x = element_text(size=14, face="bold"),
axis.title.y = element_text(size=14, face="bold"),
axis.text.x = element_text(face="bold", size=14),
axis.text.y = element_text(face="bold", size=14),
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
axis.line = element_line(color="black"))
}
## Plotting PCoAs
pdf("Plots/PCoA_all.pdf", width = 7, height = 5)
pcoa_quant$vectors%>%
as.data.frame()%>%
rownames_to_column("sample_code")%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")%>%
pcoa_settings() +
ylab(str_c("Axis 2", " (", round(pcoa_quant$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
xlab(str_c("Axis 1", " (", round(pcoa_quant$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ggtitle("quant all")
pcoa_otu$vectors%>%
as.data.frame()%>%
rownames_to_column("sample_code")%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "technical_replicates"), sep = "_")%>%
ggplot(aes(Axis.1, Axis.2, color = Organism, shape = Experiment)) +
geom_point(stat = "identity", aes(size = 0.2)) +
scale_color_manual(values = c("#75d648", "#ae2da9", "#2d67c7", "#f27304", "#64d6f7")) +
theme(panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
axis.title.x = element_text(size=14, face="bold"),
axis.title.y = element_text(size=14, face="bold"),
axis.text.x = element_text(face="bold", size=14),
axis.text.y = element_text(face="bold", size=14),
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
axis.line = element_line(color="black"))+
ylab(str_c("Axis 2", " (", round(pcoa_otu$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
xlab(str_c("Axis 1", " (", round(pcoa_otu$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ggtitle("otus")
pcoa_org$vectors%>%
as.data.frame()%>%
rownames_to_column("sample_code")%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")%>%
pcoa_settings() +
ylab(str_c("Axis 2", " (", round(pcoa_org$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
xlab(str_c("Axis 1", " (", round(pcoa_org$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ggtitle("Organism 0.05")
pcoa_dom$vectors%>%
as.data.frame()%>%
rownames_to_column("sample_code")%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")%>%
pcoa_settings() +
ylab(str_c("Axis 2", " (", round(pcoa_dom$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
xlab(str_c("Axis 1", " (", round(pcoa_dom$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ggtitle("UnfilFil 0.05")
dev.off()
# VISUALIZATION -- Mean Decrease Accuracy scatterplots -------------------------
mda_theme <- theme(panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
axis.title.x = element_text(size=14, face="bold"),
axis.title.y = element_text(size=14, face="bold"),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
axis.line = element_line(color="black"))
pdf("./Plots/Mean_Decrease_Accuracy.pdf", height = 5, width = 7)
ggplot(rf_quant_org_mda, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity") +
ggtitle("Organism QUANT Mean Decrease Accuracy pval = 0.05") +
xlab("Features (decreasing mda)") +
ylab("Mean Decrease Accuracy") +
geom_hline(yintercept = (mean(rf_quant_org_mda$MeanDecreaseAccuracy + sd(rf_quant_org_mda$MeanDecreaseAccuracy))),
col = "red") +
mda_theme
ggplot(rf_quant_dom_mda, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity") +
ggtitle("DOM Quant Mean Decrease Accuracy pval = 0.05") +
xlab("Features (decreasing mda)") +
ylab("Mean Decrease Accuracy") +
geom_hline(yintercept = (top_n(rf_quant_dom_mda, 30, MeanDecreaseAccuracy)%>%
arrange(-MeanDecreaseAccuracy))$MeanDecreaseAccuracy[30],
col = "red") +
mda_theme
ggplot(otu_rf_mda, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity") +
ggtitle("OTU Mean Decrease Accuracy pval = 0.05") +
xlab("Features (decreasing mda)") +
ylab("Mean Decrease Accuracy") +
geom_hline(yintercept = (top_n(otu_rf_mda, 30, MeanDecreaseAccuracy)%>%
arrange(-MeanDecreaseAccuracy))$MeanDecreaseAccuracy[30],
col = "red") +
mda_theme
ggplot(rf_matrix_mda_org, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity") +
ggtitle("Organism Matrix Mean Decrease Accuracy pval = 0.05") +
xlab("Features (decreasing mda)") +
ylab("Mean Decrease Accuracy") +
geom_hline(yintercept = (top_n(rf_matrix_mda_org, 30, MeanDecreaseAccuracy)%>%
arrange(-MeanDecreaseAccuracy))$MeanDecreaseAccuracy[30],
col = "red") +
mda_theme
ggplot(rf_matrix_UnfilFil_mda, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity") +
ggtitle("FilUnfil Matrix Mean Decrease Accuracy pval = 0.05") +
xlab("Features (decreasing mda)") +
ylab("Mean Decrease Accuracy") +
geom_hline(yintercept = (top_n(rf_matrix_UnfilFil_mda, 30, MeanDecreaseAccuracy)%>%
arrange(-MeanDecreaseAccuracy))$MeanDecreaseAccuracy[30],
col = "red") +
mda_theme
dev.off()
View(metadata_quant)
View(cat_stats)
View(sample_rename)
# VISUALIZATION -- VENN DIAGRAM -------------------------------------------
env_compare <- cyto_base%>%
filter(Experiment = "CCE-P1706")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
filter(feature_number %in% important_quant_org)%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
# VISUALIZATION -- VENN DIAGRAM -------------------------------------------
env_compare <- cyto_base%>%
filter(Experiment == "CCE-P1706")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
filter(feature_number %in% important_quant_org)%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
length(important_quant_org)
length(env_compare$feature_number)
# VISUALIZATION -- VENN DIAGRAM -------------------------------------------
CCE_compare <- cyto_base%>%
filter(Experiment == "CCE-P1706")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
filter(feature_number %in% important_quant_org)%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
length(important_quant_org)
length(env_compare$feature_number)
length(CCE_compare$feature_number)
Pier_compare <- cyto_base%>%
filter(Experiment == "Pier")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
filter(feature_number %in% important_quant_org)%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
length(important_quant_org)
length(Pier_compare$feature_number)
Piers_compare <- cyto_base%>%
filter(Experiment == "Piers")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
filter(feature_number %in% important_quant_org)%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
length(important_quant_org)
length(Piers_compare$feature_number)
length(CCE_compare$feature_number)
View(cyto_base)
CCE_features <- cyto_base%>%
filter(Experiment == "CCE-P1706")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
Piers_features <- cyto_base%>%
filter(Experiment == "Piers")%>%
select(-c('chl', 'ra', 'asin', 'chl_norm',"Experiment", "Organism",
"biological_replicates", "DOM_fil",
"technical_replicates"))%>%
group_by(feature_number)%>%
filter(sum(xic) != 0)%>%
ungroup()%>%
spread(sample_code, xic)
View(otu_stats)
# POST STATS -- matrix for HC ---------------------------------------------
otu_hc <- otu_stats%>%
filter(Taxonomy %in% important_org_otu)%>%
group_by(Taxonomy)%>%
filter(sample_code_16S %like% "Exp2%")%>%
#mutate(zscore = (asin - mean(asin))/sd(asin))%>%
select(-c(reads, ra))%>%
ungroup()%>%
spread(Taxonomy, zscore)
