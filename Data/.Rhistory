mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_org <- matrix_multiplied_org%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
mutate(feature = gsub("-", ".", feature))%>%
filter(feature %in% important_org_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_org, "Analyzed/mini_matrix_important_org.csv")
# STATS - T-TEST Important features org ---------------------------------------
feature_info_test <- feature_info%>%
gather(variable, response, 2:ncol(.))%>%
mutate(importance = case_when(feature_number %in% important_quant_org ~ "important",
TRUE ~ "not"),
importance = as.factor(importance))%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ t.test(.x$response ~ .x$importance, alternative = "greater")),
p_value = map(data, ~ .x["p.value"][[1]]))%>%
select(-data)%>%
ungroup()%>%
mutate(p_value = as.numeric(p_value),
FDR = p.adjust(p_value, method = "BH"))
write_csv(feature_info_test, "Analyzed/Ttest_elements_org.csv")
# STATS - T-TEST Important features DOM ---------------------------------------
feature_info_test_dom <- feature_info%>%
gather(variable, response, 2:ncol(.))%>%
mutate(importance = case_when(feature_number %in% important_quant_dom ~ "important",
TRUE ~ "not"),
importance = as.factor(importance))%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ t.test(.x$response ~ .x$importance, alternative = "greater")),
p_value = map(data, ~ .x["p.value"][[1]]))%>%
select(-data)%>%
ungroup()%>%
mutate(p_value = as.numeric(p_value),
FDR = p.adjust(p_value, method = "BH"))
write_csv(feature_info_test_dom, "Analyzed/Ttest_elements_dom.csv")
multi_matrix_tidy_org <- matrix_multiplied_org%>%
gather(category, mult, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")
# MATRIX MULTIPLICATION -- DOM_Fil--------------------------------------------
matrix_multiplied_dom <- quant_binary_dom%*%cat_clean_dom%>%
as.data.frame()%>%
rownames_to_column(var = "sample_code")%>%
gather(category, mult, 2:ncol(.))%>%
filter(category != "DBE-O")%>%
mutate(log10 = log10(mult + 1))%>%
select(-mult)%>%
spread(category, log10)
multi_matrix_tidy_dom <- matrix_multiplied_dom%>%
gather(category, mult, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")
# STATS ANOVA -- org matrix -----------------------------------------------
aov_matrix_org <- multi_matrix_tidy_org%>%
group_by(category)%>%
nest()%>%
mutate(data = map(data, ~ aov(mult ~ Organism, .x)%>%
tidy()))%>%
unnest(data)%>%
ungroup()%>%
mutate(FDR = p.adjust(p.value, method = "BH"))%>%
filter(FDR < 0.05)
matrix_aov_org_sig <- aov_matrix_org$category%>%
as.vector()
write_csv(aov_matrix_org, "Analyzed/anova_pvals_matrix_org.csv")
# STATS ANOVA -- dom matrix -----------------------------------------------
aov_matrix_dom <- multi_matrix_tidy_dom%>%
group_by(category)%>%
nest()%>%
mutate(data = map(data, ~ aov(mult ~ DOM_fil, .x)%>%
tidy()))%>%
unnest(data)%>%
ungroup()%>%
mutate(FDR = p.adjust(p.value, method = "BH"))%>%
filter(FDR < 0.05)
matrix_aov_dom_sig <- aov_matrix_dom$category%>%
as.vector()
write_csv(aov_matrix_org, "Analyzed/anova_pvals_matrix_dom.csv")
# STATS RANDOM FOREST -- Matrix  Organism-------------------------------------------
multi_matrix_random_forest_df <- multi_matrix_tidy_org%>%
filter(category %in% matrix_aov_org_sig)%>%
spread(category, mult)%>%
select(c(Organism, 7:ncol(.)))%>%
mutate(Organism = as.factor(Organism))
names(multi_matrix_random_forest_df) <- make.names(names(multi_matrix_random_forest_df))
rf_matrix <- randomForest(Organism ~ ., multi_matrix_random_forest_df,
importance = TRUE, proximity = TRUE, nPerm = 10,
ntree = 50000, na.action = na.exclude)
top30_org <- (rf_matrix$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
top_n(10, MeanDecreaseAccuracy))$feature%>%
as.vector()
rf_matrix_mda_org <- rf_matrix$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
mutate(mean_decrease_important = case_when(feature %like any% top30_org ~ "important",
TRUE ~ "not important"),
multiseries_important = case_when(multiseries >= (top_n(., 10, multiseries)%>%
arrange(-multiseries))$multiseries[10]~ "important",
TRUE ~ "not important"),
delicatissima_important = case_when(delicatissima >= (top_n(., 10, delicatissima)%>%
arrange(-delicatissima))$delicatissima[10]~ "important",
TRUE ~ "not important"),
galaxiae_important = case_when(galaxiae >= (top_n(., 10, galaxiae)%>%
arrange(-galaxiae))$galaxiae[10]~ "important",
TRUE ~ "not important"),
hasleana_important = case_when(hasleana >= (top_n(., 10, hasleana)%>%
arrange(-hasleana))$hasleana[10]~ "important",
TRUE ~ "not important"),
subpacifica_important = case_when(subpacifica >= (top_n(., 10, subpacifica)%>%
arrange(-subpacifica))$subpacifica[10]~ "important",
TRUE ~ "not important"))
write_csv(rf_matrix_mda_org,"./Analyzed/RF_matrix_organism_mda.05.csv")
ggplot(rf_matrix_mda_org, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity")
# STATS RANDOM FOREST -- Matrix  Fil_Unfil -------------------------------------------
multi_matrix_random_forest_UnfilFil_df <- multi_matrix_tidy_dom%>%
filter(category %in% matrix_aov_dom_sig)%>%
spread(category,mult)%>%
select(c(DOM_fil, 7:ncol(.)))%>%
mutate(DOM_fil = as.factor(DOM_fil))
names(multi_matrix_random_forest_UnfilFil_df) <- make.names(names(multi_matrix_random_forest_UnfilFil_df))
rf_matrix_UnfilFil <- randomForest(DOM_fil ~ ., multi_matrix_random_forest_UnfilFil_df,
importance = TRUE, proximity = TRUE,
ntree = 50000, na.action=na.exclude)
top30_unfil <- (rf_matrix_UnfilFil$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
top_n(15, MeanDecreaseAccuracy))$feature%>%
as.vector()
rf_matrix_UnfilFil_mda <- rf_matrix_UnfilFil$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
mutate(mean_decrease_important = case_when(feature %like any% top30_unfil ~ "important",
TRUE ~ "not important"),
dom_mda_important = case_when(DOM >= (top_n(., 15, DOM)%>%
arrange(-DOM))$DOM[15]~ "important",
TRUE ~ "not important"),
filt_mda_important = case_when(Unfil >= (top_n(., 15, Unfil)%>%
arrange(-Unfil))$Unfil[15]~ "important",
TRUE ~ "not important"))
write_csv(rf_matrix_UnfilFil_mda,"./Analyzed/RF_matrix_UnfilFil_mda.05.csv")
ggplot(rf_matrix_UnfilFil_mda, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity")
# STATS PERMANOVA - org and unfilfil  ---------------------------------------------------
matrix_permanova_org <- matrix_multiplied_org%>%
gather(category, mult, 2:ncol(.))%>%
mutate(mult = mult +1)%>%
spread(category, mult)%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")
permanova_org <- matrix_permanova_org%>%
# column_to_rownames("sample_code")%>%
adonis(.[7:ncol(.)] ~ Organism*DOM_fil, ., perm = 1000, method = "bray", na.rm = TRUE)
permanova_org
matrix_permanova_dom <- matrix_multiplied_dom%>%
gather(category, mult, 2:ncol(.))%>%
mutate(mult = mult +1)%>%
spread(category, mult)%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")
permanova_dom <- matrix_permanova_dom%>%
# column_to_rownames("sample_code")%>%
adonis(.[7:ncol(.)] ~ Organism*DOM_fil, ., perm = 1000, method = "bray", na.rm = TRUE)
permanova_dom
# POST-STATS -- mini-matrix organism -----------------------------------------------
important_org_compounds <- (rf_matrix_mda_org%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_org <- matrix_multiplied_org%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
mutate(feature = gsub("-", ".", feature))%>%
filter(feature %in% important_org_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_org, "Analyzed/mini_matrix_important_org.csv")
# STATS - T-TEST Important features org ---------------------------------------
feature_info_test <- feature_info%>%
gather(variable, response, 2:ncol(.))%>%
mutate(importance = case_when(feature_number %in% important_quant_org ~ "important",
TRUE ~ "not"),
importance = as.factor(importance))%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ t.test(.x$response ~ .x$importance, alternative = "greater")),
p_value = map(data, ~ .x["p.value"][[1]]))%>%
select(-data)%>%
ungroup()%>%
mutate(p_value = as.numeric(p_value),
FDR = p.adjust(p_value, method = "BH"))
write_csv(feature_info_test, "Analyzed/Ttest_elements_org.csv")
# STATS - T-TEST Important features DOM ---------------------------------------
feature_info_test_dom <- feature_info%>%
gather(variable, response, 2:ncol(.))%>%
mutate(importance = case_when(feature_number %in% important_quant_dom ~ "important",
TRUE ~ "not"),
importance = as.factor(importance))%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ t.test(.x$response ~ .x$importance, alternative = "greater")),
p_value = map(data, ~ .x["p.value"][[1]]))%>%
select(-data)%>%
ungroup()%>%
mutate(p_value = as.numeric(p_value),
FDR = p.adjust(p_value, method = "BH"))
write_csv(feature_info_test_dom, "Analyzed/Ttest_elements_dom.csv")
# POST-STATS -- mini-matrix unfilfil -----------------------------------------------
important_unfil_compounds <- (rf_matrix_UnfilFil_mda%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_dom <- matrix_multiplied_dom%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
filter(feature %in% important_unfil_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_dom, "Analyzed/mini_matrix_important_dom.csv")
# POST-STATS -- mini-matrix both org unfilfil important features ----------
mini_matrix_all <- mini_matrix_org%>%
left_join(mini_matrix_dom, by = "sample_code")
write_csv(mini_matrix_all, "Analyzed/mini_matrix_important_all.csv")
# POST STATS -- matrix for HC ---------------------------------------------
# POST-STATS -- mini-matrix unfilfil -----------------------------------------------
important_unfil_compounds <- (rf_matrix_UnfilFil_mda%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_dom <- matrix_multiplied_dom%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
filter(feature %in% important_unfil_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_dom, "Analyzed/mini_matrix_important_dom.csv")
# POST-STATS -- mini-matrix organism -----------------------------------------------
important_org_compounds <- (rf_matrix_mda_org%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_org <- matrix_multiplied_org%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
mutate(feature = gsub("-", ".", feature))%>%
filter(feature %in% important_org_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_org, "Analyzed/mini_matrix_important_org.csv")
# POST-STATS -- mini-matrix organism -----------------------------------------------
important_org_compounds <- (rf_matrix_mda_org%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
rf_matrix_mda_org <- rf_matrix$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
mutate(mean_decrease_important = case_when(feature %like any% top30_org ~ "important",
TRUE ~ "not important"),
multiseries_important = case_when(multiseries >= (top_n(., 10, multiseries)%>%
arrange(-multiseries))$multiseries[10]~ "important",
TRUE ~ "not important"),
delicatissima_important = case_when(delicatissima >= (top_n(., 10, delicatissima)%>%
arrange(-delicatissima))$delicatissima[10]~ "important",
TRUE ~ "not important"),
galaxiae_important = case_when(galaxiae >= (top_n(., 10, galaxiae)%>%
arrange(-galaxiae))$galaxiae[10]~ "important",
TRUE ~ "not important"),
hasleana_important = case_when(hasleana >= (top_n(., 10, hasleana)%>%
arrange(-hasleana))$hasleana[10]~ "important",
TRUE ~ "not important"),
subpacifica_important = case_when(subpacifica >= (top_n(., 10, subpacifica)%>%
arrange(-subpacifica))$subpacifica[10]~ "important",
TRUE ~ "not important"))
source('~/Documents/GitHub/pseudonitzschia_Koester/Code/Irina_pseudonitzschi.R', echo=TRUE)
rf_matrix_mda_org <- rf_matrix$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
mutate(mean_decrease_important = case_when(feature %like any% top30_org ~ "important",
TRUE ~ "not important"),
multiseries_important = case_when('Pn-multiseries' >= (top_n(., 10, 'Pn-multiseries')%>%
arrange(-'Pn-multiseries'))$'Pn-multiseries'[10]~ "important",
TRUE ~ "not important"),
delicatissima_important = case_when(`Pn-delicatissima` >= (top_n(., 10, `Pn-delicatissima`)%>%
arrange(-`Pn-delicatissima`))$`Pn-delicatissima`[10]~ "important",
TRUE ~ "not important"),
galaxiae_important = case_when(`Pn-galaxiae` >= (top_n(., 10, `Pn-galaxiae`)%>%
arrange(-`Pn-galaxiae`))$`Pn-galaxiae`[10]~ "important",
TRUE ~ "not important"),
hasleana_important = case_when(`Pn-hasleana` >= (top_n(., 10, `Pn-hasleana`)%>%
arrange(-`Pn-hasleana`))$`Pn-hasleana`[10]~ "important",
TRUE ~ "not important"),
subpacifica_important = case_when(`Pn-subpacifica` >= (top_n(., 10, `Pn-subpacifica`)%>%
arrange(-`Pn-subpacifica`))$`Pn-subpacifica`[10]~ "important",
TRUE ~ "not important"))
rf_matrix_mda_org <- rf_matrix$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
mutate(mean_decrease_important = case_when(feature %like any% top30_org ~ "important",
TRUE ~ "not important"),
multiseries_important = case_when(`Pn-multiseries` >= (top_n(., 10, `Pn-multiseries`)%>%
arrange(-Pn-`multiseries`))$`Pn-multiseries`[10]~ "important",
TRUE ~ "not important"),
delicatissima_important = case_when(`Pn-delicatissima` >= (top_n(., 10, `Pn-delicatissima`)%>%
arrange(-`Pn-delicatissima`))$`Pn-delicatissima`[10]~ "important",
TRUE ~ "not important"),
galaxiae_important = case_when(`Pn-galaxiae` >= (top_n(., 10, `Pn-galaxiae`)%>%
arrange(-`Pn-galaxiae`))$`Pn-galaxiae`[10]~ "important",
TRUE ~ "not important"),
hasleana_important = case_when(`Pn-hasleana` >= (top_n(., 10, `Pn-hasleana`)%>%
arrange(-`Pn-hasleana`))$`Pn-hasleana`[10]~ "important",
TRUE ~ "not important"),
subpacifica_important = case_when(`Pn-subpacifica` >= (top_n(., 10, `Pn-subpacifica`)%>%
arrange(-`Pn-subpacifica`))$`Pn-subpacifica`[10]~ "important",
TRUE ~ "not important"))
rf_matrix_mda_org <- rf_matrix$importance%>%
as.data.frame()%>%
rownames_to_column("feature")%>%
mutate(mean_decrease_important = case_when(feature %like any% top30_org ~ "important",
TRUE ~ "not important"),
multiseries_important = case_when(`Pn-multiseries` >= (top_n(., 10, `Pn-multiseries`)%>%
arrange(-`Pn-multiseries`))$`Pn-multiseries`[10]~ "important",
TRUE ~ "not important"),
delicatissima_important = case_when(`Pn-delicatissima` >= (top_n(., 10, `Pn-delicatissima`)%>%
arrange(-`Pn-delicatissima`))$`Pn-delicatissima`[10]~ "important",
TRUE ~ "not important"),
galaxiae_important = case_when(`Pn-galaxiae` >= (top_n(., 10, `Pn-galaxiae`)%>%
arrange(-`Pn-galaxiae`))$`Pn-galaxiae`[10]~ "important",
TRUE ~ "not important"),
hasleana_important = case_when(`Pn-hasleana` >= (top_n(., 10, `Pn-hasleana`)%>%
arrange(-`Pn-hasleana`))$`Pn-hasleana`[10]~ "important",
TRUE ~ "not important"),
subpacifica_important = case_when(`Pn-subpacifica` >= (top_n(., 10, `Pn-subpacifica`)%>%
arrange(-`Pn-subpacifica`))$`Pn-subpacifica`[10]~ "important",
TRUE ~ "not important"))
write_csv(rf_matrix_mda_org,"./Analyzed/RF_matrix_organism_mda.05.csv")
ggplot(rf_matrix_mda_org, aes(x= reorder(feature, -MeanDecreaseAccuracy), y = MeanDecreaseAccuracy)) +
geom_point(stat = "identity")
mportant_org_compounds <- (rf_matrix_mda_org%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_org <- matrix_multiplied_org%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
mutate(feature = gsub("-", ".", feature))%>%
filter(feature %in% important_org_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_org, "Analyzed/mini_matrix_important_org.csv")
# STATS - T-TEST Important features org ---------------------------------------
feature_info_test <- feature_info%>%
gather(variable, response, 2:ncol(.))%>%
mutate(importance = case_when(feature_number %in% important_quant_org ~ "important",
TRUE ~ "not"),
importance = as.factor(importance))%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ t.test(.x$response ~ .x$importance, alternative = "greater")),
p_value = map(data, ~ .x["p.value"][[1]]))%>%
select(-data)%>%
ungroup()%>%
mutate(p_value = as.numeric(p_value),
FDR = p.adjust(p_value, method = "BH"))
write_csv(feature_info_test, "Analyzed/Ttest_elements_org.csv")
# STATS - T-TEST Important features DOM ---------------------------------------
feature_info_test_dom <- feature_info%>%
gather(variable, response, 2:ncol(.))%>%
mutate(importance = case_when(feature_number %in% important_quant_dom ~ "important",
TRUE ~ "not"),
importance = as.factor(importance))%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ t.test(.x$response ~ .x$importance, alternative = "greater")),
p_value = map(data, ~ .x["p.value"][[1]]))%>%
select(-data)%>%
ungroup()%>%
mutate(p_value = as.numeric(p_value),
FDR = p.adjust(p_value, method = "BH"))
write_csv(feature_info_test_dom, "Analyzed/Ttest_elements_dom.csv")
# STATS Correlation analysis ----------------------------------------------
## Correlation analysis
## Doing this between OTU and multiplied matrix
correlation_matrix <- matrix_multiplied_org%>%
gather(compound, val, 2:ncol(.))%>%
mutate(compound = gsub("[[:space:]]", ".", compound))%>%
mutate(compound = gsub("-", ".", compound))%>%
filter(compound %in% important_org_compounds)%>%
spread(compound, val)%>%
separate(sample_code, c("Experiment", "Organism", "biological_replicates", "DOM_fil",
"technical_replicates"), sep = "_")%>%
select(-c(Experiment, technical_replicates))%>%
group_by(Organism, biological_replicates, DOM_fil)%>%
summarize_if(is.numeric, mean)%>%
ungroup()
correlation_microbe <- otu_stats%>%
select(-c(reads, ra))%>%
spread(Taxonomy, asin)
correlation_table <- correlation_matrix%>%
unite(sample_name, c("Organism", "biological_replicates"), sep = "_")%>%
group_by(DOM_fil)%>%
nest()%>%
mutate(data = map(data, ~ left_join(.x, correlation_microbe, by = "sample_name")%>%
gather(microbe, microbe_asin, contains(";"))%>%
gather(category, category_asin, 2:31)))
correlation_pvals <- correlation_table%>%
unnest(data)%>%
ungroup()%>%
group_by(DOM_fil, microbe, category)%>%
filter(sum(category_asin) > 0)%>%
nest()%>%
mutate(corr = map(data, ~ cor.test(.x$category_asin, .x$microbe_asin, method = "pearson")%>%
broom::tidy()))%>%
dplyr::select(-data)%>%
unnest(corr)%>%
ungroup()%>%
mutate(FDR = p.adjust(p.value, method = "BH"))
write_csv(correlation_pvals, "Analyzed/correlation_analysis.csv")
# POST-STATS -- mini-matrix unfilfil -----------------------------------------------
important_unfil_compounds <- (rf_matrix_UnfilFil_mda%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_dom <- matrix_multiplied_dom%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
filter(feature %in% important_unfil_compounds)%>%
spread(feature, val)
write_csv(mini_matrix_dom, "Analyzed/mini_matrix_important_dom.csv")
# POST-STATS -- mini-matrix both org unfilfil important features ----------
mini_matrix_all <- mini_matrix_org%>%
left_join(mini_matrix_dom, by = "sample_code")
write_csv(mini_matrix_all, "Analyzed/mini_matrix_important_all.csv")
# POST STATS -- matrix for HC ---------------------------------------------
otu_hc <- otu_stats%>%
filter(Taxonomy %in% important_org_otu)%>%
group_by(Taxonomy)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
select(-c(reads, ra, asin))%>%
spread(Taxonomy, zscore)%>%
rename("sample_code" = "sample_name")
hc_matrix <- mini_matrix_org%>%
gather(category, asin, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism",
"biological_replicate", "DOM_fil",
"technical_replicate"), sep = "_")%>%
group_by(category)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
group_by(category, Organism, biological_replicate, DOM_fil)%>%
select(-technical_replicate)%>%
summarize_if(is.numeric, mean)%>%
ungroup()%>%
filter(DOM_fil == "DOM")%>%
select(-c(asin, DOM_fil))%>%
unite(sample_code, c("Organism", "biological_replicate"), sep = "_")%>%
spread(category, zscore)
# POST-STATS -- mini-matrix organism -----------------------------------------------
important_org_compounds <- (rf_matrix_mda_org%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_org <- matrix_multiplied_org%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
mutate(feature = gsub("-", ".", feature))%>%
filter(feature %in% important_org_compounds)%>%
spread(feature, val)
# POST-STATS -- mini-matrix unfilfil -----------------------------------------------
important_unfil_compounds <- (rf_matrix_UnfilFil_mda%>%
mutate(feature = gsub("X", "", feature))%>%
top_n(30, MeanDecreaseAccuracy))$feature%>%
unique()%>%
as.vector()
mini_matrix_dom <- matrix_multiplied_dom%>%
gather(feature, val, 2:ncol(.))%>%
mutate(feature = gsub("[[:space:]]", ".", feature))%>%
filter(feature %in% important_unfil_compounds)%>%
spread(feature, val)
# POST-STATS -- mini-matrix both org unfilfil important features ----------
mini_matrix_all <- mini_matrix_org%>%
left_join(mini_matrix_dom, by = "sample_code")
hc_matrix <- mini_matrix_org%>%
gather(category, asin, 2:ncol(.))%>%
separate(sample_code, c("Experiment", "Organism",
"biological_replicate", "DOM_fil",
"technical_replicate"), sep = "_")%>%
group_by(category)%>%
mutate(zscore = (asin - mean(asin))/sd(asin))%>%
ungroup()%>%
group_by(category, Organism, biological_replicate, DOM_fil)%>%
select(-technical_replicate)%>%
summarize_if(is.numeric, mean)%>%
ungroup()%>%
filter(DOM_fil == "DOM")%>%
select(-c(asin, DOM_fil))%>%
unite(sample_code, c("Organism", "biological_replicate"), sep = "_")%>%
spread(category, zscore)
View(quant_df)
quant_blanks_env
